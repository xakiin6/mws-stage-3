class DBHelper{static host(){return"http://localhost:1337"}static endPoints(){return{RESTAURANTS:0,RESTAURANTS_BY_ID:1,REVIEWS:3,REVIEWS_BY_RESTAURANT:4,POST_REVIEWS:5,MARK_FAVOURATES:6,UNMARK_FAVOURATES:7}}static DATABASE_URL(e,t){let r;switch(e){case 0:r=`${DBHelper.host()}/restaurants`;break;case 1:r=`${DBHelper.host()}/restaurants/${t}`;break;case 4:r=`${DBHelper.host()}/reviews/?restaurant_id=${t}`;break;case 5:r=`${DBHelper.host()}/reviews/`;break;case 6:r=`${DBHelper.host()}/restaurants/${t}/?is_favorite=true`;break;case 7:r=`${DBHelper.host()}/restaurants/${t}/?is_favorite=false`;default:r=DBHelper.host()}return r}static fetchRestaurantById(e){return console.log(DBHelper.endPoints().RESTAURANTS_BY_ID),fetch(DBHelper.DATABASE_URL(DBHelper.endPoints().RESTAURANTS_BY_ID,e)).then(function(e){return e.ok?e.json():[{}]})}static postReviews(e){return fetch(DBHelper.DATABASE_URL(this.endPoints().POST_REVIEWS,null),{method:"post",body:e}).then(function(e){return e.ok?e.json():[{}]})}static fetchReviewsByRestaurant(e){return fetch(DBHelper.DATABASE_URL(DBHelper.endPoints().REVIEWS_BY_RESTAURANT,e)).then(function(e){return e.ok?e.json():[{}]})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph?e.photograph:"10"}.jpg`}static imageUrlsForSrcSet(e){var t=`${e||"10"}`;return`/img/${t}.jpg 400w, /img/${t+"-650.jpg"} 600w`}static mapMarkerForRestaurant(e,t){try{if(google){return new google.maps.Marker({position:e.latlng,title:e.name+" Restaurant",url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}catch(e){}}}window.addEventListener("load",function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw-min.js",{scope:"/"}).then(function(e){},function(e){});var e=document.querySelector("iframe");e&&e.setAttribute("title","Google Maps")});
let restaurant,reviews;var map,modalOverlay,modal;let focusedElementBeforeModal=document.activeElement;const focusableElementsString="input:not([disabled]), textarea:not([disabled]), button:not([disabled])";function initHtml(){fetchRestaurantFromURL(),modalOverlay=document.querySelector(".modal-overlay"),modal=document.querySelector(".modal")}function fetchRestaurantFromURL(){if(self.restaurant)return Promise.resolve(self.restaurant);const e=getParameterByName("id");return e?DBHelper.fetchRestaurantById(e).then(function(e){return e?(self.restaurant=e,fillRestaurantHTML(),fillBreadcrumb(),Promise.resolve(self.restaurant)):(console.error("No restaurant data"),Promise.reject("No restaurant data"))}):(console.error("No restaurant id in URL"),Promise.reject("No restaurant id in URL"))}window.initMap=(()=>{fetchRestaurantFromURL().then(function(e){console.log("test: "+e),self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(e,self.map)})}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.setAttribute("alt",e.name+" restaurant"),t.src=DBHelper.imageUrlForRestaurant(e),t.srcset=DBHelper.imageUrlsForSrcSet(e.photograph),t.sizes="(max-width: 430px) 25vw, (min-width: 650px) calc((100vw - 65px)/2)",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let r in e){const n=document.createElement("tr"),a=renderHtml("td",r);a.setAttribute("tabindex",0),n.appendChild(a);const l=renderHtml("td",e[r]);l.setAttribute("tabindex",0),n.appendChild(l),t.appendChild(n)}}),fillReviewsHTML=((e=self.reviews)=>{e||DBHelper.fetchReviewsByRestaurant(self.restaurant.id).then(function(e){console.log(e),self.reviews=e,fillReviewsHTML()});const t=document.getElementById("reviews-container");t.innerHTML="";const r=renderHtml("h3","Reviews"),n=renderHtml("button","Add Review");n.addEventListener("click",openReviewModal),n.style="float:right",r.appendChild(n),t.appendChild(r);const a=renderHtml("ul",null);if(a.id="reviews-list",e)e.forEach(e=>{a.appendChild(createReviewHTML(e))}),t.appendChild(a);else{const e=renderHtml("p","No reviews yet!");t.appendChild(e)}}),createReviewHTML=(e=>{const t=document.createElement("li"),r=renderHtml("p",e.name);r.setAttribute("class","reviews-list-title"),t.appendChild(r);const n=renderHtml("p",e.createdAt);n.setAttribute("class","reviews-list-date"),t.appendChild(n);const a=renderHtml("p",`Rating: ${e.rating}`);a.setAttribute("class","reviews-list-rating"),t.appendChild(a);const l=renderHtml("p",e.comments);return l.setAttribute("class","reviews-list-review"),t.appendChild(l),t}),openReviewModal=(()=>{focusedElementBeforeModal=document.activeElement,modal.innerHTML="",modalOverlay.addEventListener("click",closeModal);const e=renderHtml("form",null),t=renderForm("input","name","text"),r=renderHtml("label","Name:"),n=renderForm("input","rating","number");n.min="1",n.max="10";const a=renderHtml("label","Rating:"),l=renderForm("textarea","comments"),s=renderHtml("label","Comment:"),o=renderForm("button","Add_Comment","button");o.innerHTML="Add Review",o.addEventListener("click",addReview),addChildsToElement(e,[r,t,a,n,s,l,o]),modal.appendChild(e),modal.style.display="block",modalOverlay.style.display="block",modal.addEventListener("keydown",trapTabKey);var d=modal.querySelectorAll(focusableElementsString);(d=Array.prototype.slice.call(d))[0].focus()}),trapTabKey=(e=>{var t=modal.querySelectorAll(focusableElementsString),r=(t=Array.prototype.slice.call(t))[0],n=t[t.length-1];9===e.keyCode&&(e.shiftKey?document.activeElement===r&&(e.preventDefault(),n.focus()):document.activeElement===n&&(e.preventDefault(),r.focus())),27===e.keyCode&&closeModal()}),closeModal=(()=>{modal.style.display="none",modalOverlay.style.display="none",focusedElementBeforeModal.focus()}),addChildsToElement=((e,t)=>{t.forEach(t=>{e.appendChild(t)})}),addReview=(e=>{var t=modal.querySelectorAll(focusableElementsString);const r={restaurant_id:self.restaurant.id,name:t[0].value,rating:t[1].value,comments:t[2].value};checkEmptyFields(t)&&(DBHelper.postReviews(JSON.stringify(r)).then(function(e){console.log(e),self.reviews.push(e),fillReviewsHTML()}),closeModal())}),checkEmptyFields=(e=>!0),renderHtml=((e,t)=>{var r=document.createElement(e);return t&&(r.innerHTML=t),r}),renderForm=((e,t,r)=>{const n=document.createElement(e);return n.id=t,n.name=t,r&&(n.type=r),"input"!==e&&"textarea"!==e||n.setAttribute("required",""),n}),fillBreadcrumb=((e=self.restaurant)=>{if(console.log("breadcrumb :"+e),e){const t=document.getElementById("breadcrumb"),r=renderHtml("li",e.name);r.setAttribute("aria-current","page"),t.appendChild(r)}}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null});